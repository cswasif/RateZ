<!DOCTYPE html>
<html>
<head>
    <title>WASM Module Test</title>
</head>
<body>
    <h1>WASM Module Test</h1>
    <div id="status">Loading...</div>
    <div id="result"></div>
    
    <script type="module">
        async function testWASM() {
            const statusEl = document.getElementById('status');
            const resultEl = document.getElementById('result');
            
            try {
                statusEl.textContent = 'Loading WASM module...';
                
                // Test loading the WASM module directly
                const module = await import('./packages/frontend/src/lib/zk-wasm-pkg/zk_wasm.js');
                console.log('Module loaded:', module);
                
                statusEl.textContent = 'Initializing WASM...';
                await module.default();
                
                statusEl.textContent = 'WASM module loaded successfully!';
                
                // Test if the partial hash function exists
                if (typeof module.compute_partial_hash_for_email === 'function') {
                    resultEl.innerHTML = '<p style="color: green;">✓ compute_partial_hash_for_email function found</p>';
                    
                    // Test with a simple email header
                    const testHeader = "From: test@bracu.ac.bd\r\nTo: recipient@example.com\r\nSubject: Test Email";
                    const headerBytes = new TextEncoder().encode(testHeader);
                    
                    const hashResult = module.compute_partial_hash_for_email(headerBytes, 2560);
                    resultEl.innerHTML += '<p style="color: green;">✓ Partial hash computation works</p>';
                    resultEl.innerHTML += `<p>State: [${hashResult.state.join(', ')}]</p>`;
                    resultEl.innerHTML += `<p>Remaining bytes: ${hashResult.remaining.length}</p>`;
                    resultEl.innerHTML += `<p>Total length: ${hashResult.total_length}</p>`;
                    resultEl.innerHTML += `<p>Prehashed length: ${hashResult.prehashed_length}</p>`;
                } else {
                    resultEl.innerHTML = '<p style="color: orange;">⚠ compute_partial_hash_for_email function not found</p>';
                    resultEl.innerHTML += '<p>Available functions: ' + Object.keys(module).join(', ') + '</p>';
                }
                
            } catch (error) {
                statusEl.textContent = 'Error loading WASM module';
                resultEl.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                console.error('WASM loading error:', error);
            }
        }
        
        testWASM();
    </script>
</body>
</html>